// routes/adminServicos.js

const express = require("express");
const router = express.Router();
const pool = require("../config/pool"); // Conex√£o com o banco MySQL
const verifyAdmin = require("../middleware/verifyAdmin"); // Middleware de autentica√ß√£o

// üîê GET /admin/servicos ‚Äî Lista todos os colaboradores com suas especialidades
router.get("/", verifyAdmin, async (req, res) => {
  try {
    // Consulta JOIN: retorna os dados dos colaboradores + nome da especialidade
    const [rows] = await pool.query(`
      SELECT 
        c.id,
        c.nome,
        c.cargo,
        c.whatsapp,
        c.imagem,
        c.descricao,
        c.especialidade_id,
        e.nome AS especialidade_nome
      FROM colaboradores c
      LEFT JOIN especialidades e ON c.especialidade_id = e.id
    `);

    res.json(rows); // Retorna o array de objetos com os dados dos servi√ßos
  } catch (err) {
    console.error("Erro ao buscar servi√ßos:", err);
    res.status(500).json({ message: "Erro ao buscar servi√ßos." });
  }
});

module.exports = router; // Exporta o roteador
