/* eslint-disable no-unused-vars */
"use strict";

module.exports = {
  async up(queryInterface, Sequelize) {
    await queryInterface.sequelize.transaction(async (t) => {
      await queryInterface.sequelize.query("CREATE TABLE `drone_comments` (\n`id` int NOT NULL AUTO_INCREMENT,\n`model_key` varchar(20) DEFAULT NULL,\n`display_name` varchar(80) DEFAULT NULL,\n`comment_text` varchar(1000) NOT NULL,\n`status` enum('PENDENTE','APROVADO','REPROVADO') NOT NULL DEFAULT 'PENDENTE',\n`ip_hash` char(64) DEFAULT NULL,\n`user_agent` varchar(255) DEFAULT NULL,\n`created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,\n`updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\nPRIMARY KEY (`id`),\nKEY `idx_comment_status_created` (`status`,`created_at`),\nKEY `idx_comment_created` (`created_at`),\nKEY `idx_drone_comments_model_created` (`model_key`,`created_at`)\n) ENGINE=InnoDB AUTO_INCREMENT=12 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;", { transaction: t });
      await queryInterface.sequelize.query("CREATE TABLE `drone_models` (\n`id` int NOT NULL AUTO_INCREMENT,\n`key` varchar(20) NOT NULL,\n`label` varchar(120) NOT NULL,\n`is_active` tinyint(1) NOT NULL DEFAULT '1',\n`sort_order` int NOT NULL DEFAULT '0',\n`created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,\n`updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\nPRIMARY KEY (`id`),\nUNIQUE KEY `uq_drone_models_key` (`key`)\n) ENGINE=InnoDB AUTO_INCREMENT=8 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;", { transaction: t });
      await queryInterface.sequelize.query("CREATE TABLE `drone_page_settings` (\n`id` int NOT NULL AUTO_INCREMENT,\n`hero_title` varchar(120) NOT NULL,\n`hero_subtitle` varchar(255) DEFAULT NULL,\n`hero_video_path` varchar(255) DEFAULT NULL,\n`hero_image_fallback_path` varchar(255) DEFAULT NULL,\n`cta_title` varchar(120) DEFAULT NULL,\n`cta_message_template` varchar(500) DEFAULT NULL,\n`cta_button_label` varchar(60) DEFAULT NULL,\n`specs_title` varchar(120) DEFAULT NULL,\n`specs_items_json` json DEFAULT NULL,\n`features_title` varchar(120) DEFAULT NULL,\n`features_items_json` json DEFAULT NULL,\n`benefits_title` varchar(120) DEFAULT NULL,\n`benefits_items_json` json DEFAULT NULL,\n`sections_order_json` json DEFAULT NULL,\n`created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,\n`updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n`models_json` json DEFAULT NULL,\nPRIMARY KEY (`id`)\n) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;", { transaction: t });
      await queryInterface.sequelize.query("CREATE TABLE `drone_representatives` (\n`id` int NOT NULL AUTO_INCREMENT,\n`name` varchar(120) NOT NULL,\n`whatsapp` varchar(30) NOT NULL,\n`cnpj` varchar(20) NOT NULL,\n`instagram_url` varchar(255) DEFAULT NULL,\n`address_street` varchar(120) NOT NULL,\n`address_number` varchar(30) NOT NULL,\n`address_complement` varchar(80) DEFAULT NULL,\n`address_neighborhood` varchar(80) DEFAULT NULL,\n`address_city` varchar(80) DEFAULT NULL,\n`address_uf` char(2) DEFAULT NULL,\n`address_cep` varchar(15) DEFAULT NULL,\n`notes` varchar(255) DEFAULT NULL,\n`sort_order` int NOT NULL DEFAULT '0',\n`is_active` tinyint(1) NOT NULL DEFAULT '1',\n`created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,\n`updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\nPRIMARY KEY (`id`),\nKEY `idx_rep_active_order` (`is_active`,`sort_order`),\nKEY `idx_rep_city_uf` (`address_city`,`address_uf`),\nKEY `idx_rep_name` (`name`)\n) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;", { transaction: t });
      await queryInterface.sequelize.query("CREATE TABLE `drone_comment_media` (\n`id` int NOT NULL AUTO_INCREMENT,\n`comment_id` int NOT NULL,\n`media_type` enum('IMAGE','VIDEO') NOT NULL,\n`media_path` varchar(255) NOT NULL,\n`created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,\nPRIMARY KEY (`id`),\nKEY `idx_media_comment` (`comment_id`),\nKEY `idx_media_created` (`created_at`),\nCONSTRAINT `fk_comment_media_comment` FOREIGN KEY (`comment_id`) REFERENCES `drone_comments` (`id`) ON DELETE CASCADE\n) ENGINE=InnoDB AUTO_INCREMENT=16 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;", { transaction: t });
      await queryInterface.sequelize.query("CREATE TABLE `drone_gallery_items` (\n`id` int NOT NULL AUTO_INCREMENT,\n`model_key` varchar(20) DEFAULT NULL,\n`media_type` enum('IMAGE','VIDEO') NOT NULL,\n`media_path` varchar(255) NOT NULL,\n`caption` varchar(160) DEFAULT NULL,\n`sort_order` int NOT NULL DEFAULT '0',\n`is_active` tinyint(1) NOT NULL DEFAULT '1',\n`created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,\n`updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\nPRIMARY KEY (`id`),\nKEY `idx_gallery_active_order` (`is_active`,`sort_order`),\nKEY `idx_gallery_created` (`created_at`),\nKEY `idx_drone_gallery_model_sort_active` (`model_key`,`sort_order`,`is_active`),\nKEY `idx_drone_gallery_items_model_key` (`model_key`),\nKEY `idx_drone_gallery_items_model_active_order` (`model_key`,`is_active`,`sort_order`),\nCONSTRAINT `fk_gallery_model_key` FOREIGN KEY (`model_key`) REFERENCES `drone_models` (`key`) ON DELETE RESTRICT ON UPDATE CASCADE\n) ENGINE=InnoDB AUTO_INCREMENT=31 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;", { transaction: t });
      await queryInterface.sequelize.query("CREATE TABLE `drone_model_media_selections` (\n`id` int NOT NULL AUTO_INCREMENT,\n`model_key` varchar(20) NOT NULL,\n`target` enum('HERO','CARD') NOT NULL,\n`media_id` int DEFAULT NULL,\n`created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,\n`updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\nPRIMARY KEY (`id`),\nUNIQUE KEY `uq_model_target` (`model_key`,`target`),\nKEY `fk_sel_media` (`media_id`),\nCONSTRAINT `fk_sel_media` FOREIGN KEY (`media_id`) REFERENCES `drone_gallery_items` (`id`) ON DELETE SET NULL,\nCONSTRAINT `fk_sel_model` FOREIGN KEY (`model_key`) REFERENCES `drone_models` (`key`) ON DELETE CASCADE\n) ENGINE=InnoDB AUTO_INCREMENT=7 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;", { transaction: t });
    });
  },

  async down(queryInterface, Sequelize) {
    await queryInterface.sequelize.transaction(async (t) => {
      await queryInterface.sequelize.query("DROP TABLE IF EXISTS `drone_model_media_selections`;", { transaction: t });
      await queryInterface.sequelize.query("DROP TABLE IF EXISTS `drone_gallery_items`;", { transaction: t });
      await queryInterface.sequelize.query("DROP TABLE IF EXISTS `drone_comment_media`;", { transaction: t });
      await queryInterface.sequelize.query("DROP TABLE IF EXISTS `drone_representatives`;", { transaction: t });
      await queryInterface.sequelize.query("DROP TABLE IF EXISTS `drone_page_settings`;", { transaction: t });
      await queryInterface.sequelize.query("DROP TABLE IF EXISTS `drone_models`;", { transaction: t });
      await queryInterface.sequelize.query("DROP TABLE IF EXISTS `drone_comments`;", { transaction: t });
    });
  },
};
