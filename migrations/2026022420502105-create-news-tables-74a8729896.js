/* eslint-disable no-unused-vars */
"use strict";

module.exports = {
  async up(queryInterface, Sequelize) {
    await queryInterface.sequelize.transaction(async (t) => {
      await queryInterface.sequelize.query("CREATE TABLE `news_clima` (\n`id` int NOT NULL AUTO_INCREMENT,\n`city_name` varchar(120) COLLATE utf8mb4_unicode_ci NOT NULL,\n`slug` varchar(140) COLLATE utf8mb4_unicode_ci NOT NULL,\n`uf` char(2) COLLATE utf8mb4_unicode_ci NOT NULL,\n`ibge_id` int unsigned DEFAULT NULL,\n`station_code` varchar(10) COLLATE utf8mb4_unicode_ci DEFAULT NULL,\n`station_name` varchar(120) COLLATE utf8mb4_unicode_ci DEFAULT NULL,\n`station_uf` char(2) COLLATE utf8mb4_unicode_ci DEFAULT NULL,\n`station_lat` decimal(9,6) DEFAULT NULL,\n`station_lon` decimal(9,6) DEFAULT NULL,\n`station_distance` decimal(8,2) DEFAULT NULL,\n`station_distance_km` decimal(8,2) DEFAULT NULL,\n`ibge_source` varchar(120) COLLATE utf8mb4_unicode_ci DEFAULT NULL,\n`station_source` varchar(120) COLLATE utf8mb4_unicode_ci DEFAULT NULL,\n`last_sync_observed_at` datetime DEFAULT NULL,\n`last_sync_forecast_at` datetime DEFAULT NULL,\n`mm_24h` decimal(8,2) DEFAULT NULL,\n`mm_7d` decimal(8,2) DEFAULT NULL,\n`source` varchar(120) COLLATE utf8mb4_unicode_ci DEFAULT NULL,\n`last_update_at` datetime DEFAULT NULL,\n`ativo` tinyint(1) NOT NULL DEFAULT '1',\n`criado_em` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,\n`atualizado_em` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\nPRIMARY KEY (`id`),\nUNIQUE KEY `uk_news_clima_slug` (`slug`),\nKEY `idx_news_clima_ativo` (`ativo`),\nKEY `idx_news_clima_uf` (`uf`),\nKEY `idx_news_clima_ibge_id` (`ibge_id`),\nKEY `idx_news_clima_station_code` (`station_code`)\n) ENGINE=InnoDB AUTO_INCREMENT=17 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;", { transaction: t });
      await queryInterface.sequelize.query("CREATE TABLE `news_cotacoes` (\n`id` int unsigned NOT NULL AUTO_INCREMENT,\n`name` varchar(160) COLLATE utf8mb4_unicode_ci NOT NULL,\n`slug` varchar(180) COLLATE utf8mb4_unicode_ci NOT NULL,\n`group_key` enum('graos','pecuaria','cambio') COLLATE utf8mb4_unicode_ci NOT NULL DEFAULT 'graos',\n`type` varchar(40) COLLATE utf8mb4_unicode_ci NOT NULL,\n`price` decimal(12,4) DEFAULT NULL,\n`unit` varchar(40) COLLATE utf8mb4_unicode_ci DEFAULT NULL,\n`variation_day` decimal(10,4) DEFAULT NULL,\n`market` varchar(120) COLLATE utf8mb4_unicode_ci DEFAULT NULL,\n`source` varchar(120) COLLATE utf8mb4_unicode_ci DEFAULT NULL,\n`last_update_at` datetime DEFAULT NULL,\n`last_sync_status` enum('ok','error','skipped') COLLATE utf8mb4_unicode_ci DEFAULT NULL,\n`last_sync_message` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL,\n`ativo` tinyint(1) NOT NULL DEFAULT '1',\n`criado_em` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,\n`atualizado_em` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\nPRIMARY KEY (`id`),\nUNIQUE KEY `uk_news_cotacoes_slug` (`slug`),\nKEY `idx_news_cotacoes_type` (`type`),\nKEY `idx_news_cotacoes_ativo` (`ativo`),\nKEY `idx_news_cotacoes_last_update` (`last_update_at`),\nKEY `idx_news_cotacoes_group_key` (`group_key`)\n) ENGINE=InnoDB AUTO_INCREMENT=11 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;", { transaction: t });
      await queryInterface.sequelize.query("CREATE TABLE `news_cotacoes_history` (\n`id` bigint unsigned NOT NULL AUTO_INCREMENT,\n`cotacao_id` int unsigned NOT NULL,\n`price` decimal(12,4) DEFAULT NULL,\n`variation_day` decimal(12,4) DEFAULT NULL,\n`source` varchar(120) DEFAULT NULL,\n`observed_at` datetime DEFAULT NULL,\n`sync_status` enum('ok','error') NOT NULL DEFAULT 'ok',\n`sync_message` varchar(255) DEFAULT NULL,\n`created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\nPRIMARY KEY (`id`),\nKEY `idx_cotacao_created` (`cotacao_id`,`created_at`),\nCONSTRAINT `fk_cotacoes_history` FOREIGN KEY (`cotacao_id`) REFERENCES `news_cotacoes` (`id`) ON DELETE CASCADE\n) ENGINE=InnoDB AUTO_INCREMENT=82 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;", { transaction: t });
      await queryInterface.sequelize.query("CREATE TABLE `news_posts` (\n`id` int NOT NULL AUTO_INCREMENT,\n`title` varchar(220) COLLATE utf8mb4_unicode_ci NOT NULL,\n`slug` varchar(240) COLLATE utf8mb4_unicode_ci NOT NULL,\n`excerpt` varchar(500) COLLATE utf8mb4_unicode_ci DEFAULT NULL,\n`content` longtext COLLATE utf8mb4_unicode_ci NOT NULL,\n`cover_image_url` varchar(500) COLLATE utf8mb4_unicode_ci DEFAULT NULL,\n`category` varchar(80) COLLATE utf8mb4_unicode_ci DEFAULT NULL,\n`tags` varchar(500) COLLATE utf8mb4_unicode_ci DEFAULT NULL,\n`status` enum('draft','published','archived') COLLATE utf8mb4_unicode_ci NOT NULL DEFAULT 'draft',\n`published_at` datetime DEFAULT NULL,\n`author_admin_id` int DEFAULT NULL,\n`views` int NOT NULL DEFAULT '0',\n`ativo` tinyint(1) NOT NULL DEFAULT '1',\n`criado_em` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,\n`atualizado_em` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\nPRIMARY KEY (`id`),\nUNIQUE KEY `uk_news_posts_slug` (`slug`),\nKEY `idx_news_posts_status_pub` (`status`,`published_at`),\nKEY `idx_news_posts_author` (`author_admin_id`),\nKEY `idx_news_posts_ativo` (`ativo`),\nFULLTEXT KEY `ft_news_posts_search` (`title`,`excerpt`,`content`),\nCONSTRAINT `fk_news_posts_author_admin` FOREIGN KEY (`author_admin_id`) REFERENCES `admins` (`id`) ON DELETE SET NULL ON UPDATE CASCADE\n) ENGINE=InnoDB AUTO_INCREMENT=8 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;", { transaction: t });
    });
  },

  async down(queryInterface, Sequelize) {
    await queryInterface.sequelize.transaction(async (t) => {
      await queryInterface.sequelize.query("DROP TABLE IF EXISTS `news_posts`;", { transaction: t });
      await queryInterface.sequelize.query("DROP TABLE IF EXISTS `news_cotacoes_history`;", { transaction: t });
      await queryInterface.sequelize.query("DROP TABLE IF EXISTS `news_cotacoes`;", { transaction: t });
      await queryInterface.sequelize.query("DROP TABLE IF EXISTS `news_clima`;", { transaction: t });
    });
  },
};
